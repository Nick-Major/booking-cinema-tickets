// @ts-nocheck

import HallsManager from '../../modules/halls.js';
import NotificationSystem from '../../core/notifications.js';
import { initAccordeon } from '../../modules/accordeon.js';
import { 
    initModalHandlers, 
    closeAddHallModal, 
    closeAddMovieModal, 
    closeEditMovieModal, 
    closeAddSessionModal, 
    closeEditSessionModal, 
    closeDeleteHallModal, 
    closeDeleteMovieModal, 
    closeDeleteSessionModal, 
    closeAllModals, 
    openModal, 
    closeModal 
} from '../../core/modals.js';
import { 
    initSessionFormHandlers, 
    initTimeValidation,
    openAddSessionModal,
    changeTimelineDate
} from '../../modules/sessions.js';
import { 
    // openEditMovieModal, 
    toggleInactiveMovies, 
    initMovieFilter 
} from '../../modules/movies.js';
import { 
    loadHallConfiguration, 
    loadPriceConfiguration 
} from '../../modules/halls.js';
import './hall-configuration.js';
import '../../modules/pricing.js';
import './modals/add-movie-modal.js';

// ============================================================================
// VIEW-SPECIFIC –§–£–ù–ö–¶–ò–ò
// ============================================================================
function resetSessions() {
    if (window.notifications) {
        window.notifications.show('–§—É–Ω–∫—Ü–∏—è resetSessions –≤—ã–∑–≤–∞–Ω–∞', 'info');
    }
}

function updateSession() {
    if (window.notifications) {
        window.notifications.show('–§—É–Ω–∫—Ü–∏—è updateSession –≤—ã–∑–≤–∞–Ω–∞', 'info');
    }
}

// –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è openEditMovieModal
function openEditMovieModal(movieId) {
    console.log('Edit movie modal temporarily disabled. Movie ID:', movieId);
    if (window.notifications) {
        window.notifications.show('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'info');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
function openCreateScheduleModal(hallId, date) {
    console.log('üéØ –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', { hallId, date });
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
    document.getElementById('hall_schedule_id').value = '';
    document.getElementById('hall_id').value = hallId;
    document.getElementById('schedule_date').value = date;
    document.getElementById('start_time').value = '09:00';
    document.getElementById('end_time').value = '23:00';
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    document.getElementById('modal_hall_name').textContent = '–ó–∞–ª ' + hallId;
    document.getElementById('modal_schedule_date').textContent = new Date(date).toLocaleDateString();
    document.getElementById('hallScheduleModalTitle').textContent = '–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è';
    document.getElementById('hallScheduleSubmitBtn').textContent = '–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ';
    
    openModal('hallScheduleModal');
}

function openEditScheduleModal(scheduleId) {
    console.log('üéØ –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:', scheduleId);
    alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ');
}

// ============================================================================
// –û–°–ù–û–í–ù–û–ô –ö–û–î
// ============================================================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('Admin panel initializing...');
    
    try {
        console.log('‚úÖ Loading NotificationSystem...');
        const notifications = new NotificationSystem();
        
        console.log('‚úÖ Loading HallsManager...');
        const hallsManager = new HallsManager(notifications);
        
        window.notifications = notifications;
        
        console.log('‚úÖ Initializing accordeon...');
        initAccordeon();
        
        console.log('‚úÖ Initializing modal handlers...');
        initModalHandlers(); // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!
        
        console.log('‚úÖ Initializing session form handlers...');
        initSessionFormHandlers();
        
        console.log('‚úÖ Initializing time validation...');
        initTimeValidation();
        
        console.log('‚úÖ Initializing movie filter...');
        initMovieFilter();
        
        console.log('üéâ Admin panel initialized successfully!');
    } catch (error) {
        console.error('üí• Error during admin panel initialization:', error);
    }

    // –≠–ö–°–ü–û–†–¢–ò–†–£–ï–ú –í–°–ï –ù–ï–û–ë–•–û–î–ò–ú–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´
    window.resetSessions = resetSessions;
    window.updateSession = updateSession;
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    window.openEditMovieModal = openEditMovieModal;
    window.loadHallConfiguration = loadHallConfiguration;
    window.loadPriceConfiguration = loadPriceConfiguration;
    window.toggleInactiveMovies = toggleInactiveMovies;
    window.openAddSessionModal = openAddSessionModal;
    window.changeTimelineDate = changeTimelineDate;
    window.openModal = openModal;
    window.closeModal = closeModal;
    window.closeAllModals = closeAllModals;

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    window.openCreateScheduleModal = openCreateScheduleModal;
    window.openEditScheduleModal = openEditScheduleModal;

    // –§—É–Ω–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    window.closeAddHallModal = closeAddHallModal;
    window.closeAddMovieModal = closeAddMovieModal;
    window.closeEditMovieModal = closeEditMovieModal;
    window.closeAddSessionModal = closeAddSessionModal;
    window.closeEditSessionModal = closeEditSessionModal;
    window.closeDeleteHallModal = closeDeleteHallModal;
    window.closeDeleteMovieModal = closeDeleteMovieModal;
    window.closeDeleteSessionModal = closeDeleteSessionModal;
});
